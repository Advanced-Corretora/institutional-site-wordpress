{"version":3,"file":"carousel.js","sources":["../../src/js/modules/carousel.js"],"sourcesContent":["import Flickity from 'flickity';\r\n\r\nfunction equalizeCarouselHeights(carouselEl) {\r\n  const products = carouselEl.querySelectorAll('.carousel-cell .product');\r\n  if (!products.length) return;\r\n  // reset to natural height before measuring\r\n  products.forEach(el => (el.style.height = 'auto'));\r\n  let max = 0;\r\n  products.forEach(el => {\r\n    const h = el.offsetHeight;\r\n    if (h > max) max = h;\r\n  });\r\n  if (max > 0) {\r\n    products.forEach(el => (el.style.height = max + 'px'));\r\n  }\r\n}\r\n\r\nfunction setupEqualize(flkty, carouselEl) {\r\n  const debounced = (() => {\r\n    let frame;\r\n    return () => {\r\n      cancelAnimationFrame(frame);\r\n      frame = requestAnimationFrame(() => equalizeCarouselHeights(carouselEl));\r\n    };\r\n  })();\r\n\r\n  flkty.on('ready', debounced);\r\n  flkty.on('change', debounced);\r\n  flkty.on('settle', debounced);\r\n  flkty.on('resize', debounced);\r\n\r\n  // Recalculate after images load\r\n  const imgs = carouselEl.querySelectorAll('img');\r\n  imgs.forEach(img => {\r\n    if (img.complete) return; // skip already-loaded\r\n    img.addEventListener('load', debounced, { once: true });\r\n    img.addEventListener('error', debounced, { once: true });\r\n  });\r\n\r\n  // Initial run\r\n  debounced();\r\n  // After window load as a fallback\r\n  window.addEventListener('load', debounced, { once: true });\r\n}\r\n\r\nlet flickityInstances = [];\r\n\r\nconst createFlickityInstance = carousel => {\r\n  const flkty = new Flickity(carousel, {\r\n    wrapAround: true,\r\n    pageDots: false,\r\n    prevNextButtons: true,\r\n    contain: false,\r\n    cellAlign: 'center',\r\n    initialIndex: 0,\r\n    percentPosition: false,\r\n    // add other options here if needed\r\n  });\r\n\r\n  // Force hide dots and ensure buttons are visible after initialization\r\n  flkty.on('ready', () => {\r\n    const dotsContainer = carousel.querySelector('.flickity-page-dots');\r\n    if (dotsContainer) {\r\n      dotsContainer.style.display = 'none';\r\n    }\r\n    \r\n    const buttons = carousel.querySelectorAll('.flickity-prev-next-button');\r\n    buttons.forEach(button => {\r\n      button.style.display = 'block';\r\n    });\r\n  });\r\n\r\n  return flkty;\r\n};\r\n\r\nconst destroyAllInstances = () => {\r\n  flickityInstances.forEach(instance => {\r\n    if (instance.flkty && typeof instance.flkty.destroy === 'function') {\r\n      instance.flkty.destroy();\r\n    }\r\n  });\r\n  flickityInstances = [];\r\n};\r\n\r\nconst initializeCarousels = () => {\r\n  const carousels = document.querySelectorAll('.gutenberg-flickity');\r\n\r\n  carousels.forEach(carousel => {\r\n    // Wait a bit to ensure Flickity is fully loaded\r\n    setTimeout(() => {\r\n      const flkty = createFlickityInstance(carousel);\r\n      setupEqualize(flkty, carousel);\r\n\r\n      flickityInstances.push({\r\n        element: carousel,\r\n        flkty: flkty,\r\n      });\r\n    }, 50);\r\n  });\r\n};\r\n\r\nconst gutenbergCarousel = () => {\r\n  initializeCarousels();\r\n\r\n  // Debounced resize handler\r\n  let resizeTimeout;\r\n  const handleResize = () => {\r\n    clearTimeout(resizeTimeout);\r\n    resizeTimeout = setTimeout(() => {\r\n      destroyAllInstances();\r\n      initializeCarousels();\r\n    }, 250);\r\n  };\r\n\r\n  window.addEventListener('resize', handleResize);\r\n};\r\n\r\n// Wait for both DOM and window load to ensure everything is ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  // Additional delay to ensure Flickity library is fully loaded\r\n  setTimeout(gutenbergCarousel, 100);\r\n});\r\n\r\n// Fallback for window load\r\nwindow.addEventListener('load', () => {\r\n  // Only initialize if not already done\r\n  if (flickityInstances.length === 0) {\r\n    gutenbergCarousel();\r\n  }\r\n});\r\n"],"names":["equalizeCarouselHeights","carouselEl","products","el","max","h","setupEqualize","flkty","debounced","frame","img","flickityInstances","createFlickityInstance","carousel","Flickity","dotsContainer","button","destroyAllInstances","instance","initializeCarousels","gutenbergCarousel","resizeTimeout","handleResize"],"mappings":"gDAEA,SAASA,EAAwBC,EAAY,CAC3C,MAAMC,EAAWD,EAAW,iBAAiB,yBAAyB,EACtE,GAAI,CAACC,EAAS,OAAQ,OAEtBA,EAAS,QAAQC,GAAOA,EAAG,MAAM,OAAS,MAAO,EACjD,IAAIC,EAAM,EACVF,EAAS,QAAQC,GAAM,CACrB,MAAME,EAAIF,EAAG,aACTE,EAAID,IAAKA,EAAMC,EACrB,CAAC,EACGD,EAAM,GACRF,EAAS,QAAQC,GAAOA,EAAG,MAAM,OAASC,EAAM,IAAK,CAEzD,CAEA,SAASE,EAAcC,EAAON,EAAY,CACxC,MAAMO,GAAa,IAAM,CACvB,IAAIC,EACJ,MAAO,IAAM,CACX,qBAAqBA,CAAK,EAC1BA,EAAQ,sBAAsB,IAAMT,EAAwBC,CAAU,CAAC,CACzE,CACF,KAEAM,EAAM,GAAG,QAASC,CAAS,EAC3BD,EAAM,GAAG,SAAUC,CAAS,EAC5BD,EAAM,GAAG,SAAUC,CAAS,EAC5BD,EAAM,GAAG,SAAUC,CAAS,EAGfP,EAAW,iBAAiB,KAAK,EACzC,QAAQS,GAAO,CACdA,EAAI,WACRA,EAAI,iBAAiB,OAAQF,EAAW,CAAE,KAAM,EAAI,CAAE,EACtDE,EAAI,iBAAiB,QAASF,EAAW,CAAE,KAAM,EAAI,CAAE,EACzD,CAAC,EAGDA,IAEA,OAAO,iBAAiB,OAAQA,EAAW,CAAE,KAAM,EAAI,CAAE,CAC3D,CAEA,IAAIG,EAAoB,CAAA,EAExB,MAAMC,EAAyBC,GAAY,CACzC,MAAMN,EAAQ,IAAIO,EAASD,EAAU,CACnC,WAAY,GACZ,SAAU,GACV,gBAAiB,GACjB,QAAS,GACT,UAAW,SACX,aAAc,EACd,gBAAiB,EAErB,CAAG,EAGD,OAAAN,EAAM,GAAG,QAAS,IAAM,CACtB,MAAMQ,EAAgBF,EAAS,cAAc,qBAAqB,EAC9DE,IACFA,EAAc,MAAM,QAAU,QAGhBF,EAAS,iBAAiB,4BAA4B,EAC9D,QAAQG,GAAU,CACxBA,EAAO,MAAM,QAAU,OACzB,CAAC,CACH,CAAC,EAEMT,CACT,EAEMU,EAAsB,IAAM,CAChCN,EAAkB,QAAQO,GAAY,CAChCA,EAAS,OAAS,OAAOA,EAAS,MAAM,SAAY,YACtDA,EAAS,MAAM,SAEnB,CAAC,EACDP,EAAoB,CAAA,CACtB,EAEMQ,EAAsB,IAAM,CACd,SAAS,iBAAiB,qBAAqB,EAEvD,QAAQN,GAAY,CAE5B,WAAW,IAAM,CACf,MAAMN,EAAQK,EAAuBC,CAAQ,EAC7CP,EAAcC,EAAOM,CAAQ,EAE7BF,EAAkB,KAAK,CACrB,QAASE,EACT,MAAON,CACf,CAAO,CACH,EAAG,EAAE,CACP,CAAC,CACH,EAEMa,EAAoB,IAAM,CAC9BD,IAGA,IAAIE,EACJ,MAAMC,EAAe,IAAM,CACzB,aAAaD,CAAa,EAC1BA,EAAgB,WAAW,IAAM,CAC/BJ,IACAE,GACF,EAAG,GAAG,CACR,EAEA,OAAO,iBAAiB,SAAUG,CAAY,CAChD,EAGA,SAAS,iBAAiB,mBAAoB,IAAM,CAElD,WAAWF,EAAmB,GAAG,CACnC,CAAC,EAGD,OAAO,iBAAiB,OAAQ,IAAM,CAEhCT,EAAkB,SAAW,GAC/BS,GAEJ,CAAC"}